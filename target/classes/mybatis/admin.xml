<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Admin">
	
	<sql id="search">
		<where>
			<if test="search == 1">
				loc LIKE CONCAT('%',CONCAT(#{keyword}, '%'))
			</if>
			<if test="search == 2">
				max_number LIKE CONCAT('%',CONCAT(#{keyword}, '%'))
			</if>
			<if test="search == 3">
				price = #{keyword}
			</if>
		</where>
	</sql>
	
	<insert id="insert">					
		INSERT INTO admin
		VALUES (#{id}, #{password}, #{name})
	</insert>
	
	<select id="loginCheck" parameterType="Admin" resultType="Admin">
		select * from admin
		where id=#{id} and password=#{password}
	</select>
	
	<insert id="roomOptionRegist">					
		INSERT INTO room_option
		VALUES (NULL, #{roomType}, #{price}, #{maxNumber}, #{detail})
	</insert>
	
	<select id="roomOptionList" resultType="RoomOption">
		SELECT * FROM room_option
	</select>
	
	<delete id="delete">
		DELETE FROM room_option WHERE room_option_id= #{roomOptionId}
	</delete>
	
	<update id="edit">
		UPDATE room_option
		SET room_type = #{roomType}, price = #{price}, max_number = #{maxNumber}, detail = #{detail}
		WHERE room_option_id =#{roomOptionId}
	</update>
	
	<insert id="serviceOptionRegist">					
		INSERT INTO service_option
		VALUES (NULL, #{serviceName}, #{price}, #{detail})
	</insert>
	
	<select id="serviceOptionList" resultType="serviceOption">
		SELECT * FROM service_option
	</select>
	
	<delete id="deleteServiceOption">
		DELETE FROM service_option WHERE service_option_id= #{serviceOptionId}
	</delete>
	
	<update id="editService">
		UPDATE service_option
		SET service_name = #{serviceName}, price = #{price}, detail = #{detail}
		WHERE service_option_id =#{serviceOptionId}
	</update>
	
	<insert id="roomRegist">					
		INSERT INTO room
		VALUES (NULL, #{loc}, #{num}, #{price}, #{latitude}, #{longitude})
	</insert>
	
	<select id="roomList" resultMap="RoomMap">
		SELECT room.*,
			product_img.productImg_id productImgId,
			product_img.room_id room_id,
			product_img.filename filename,
			product_img.uuid uuid
		FROM room
		JOIN product_img ON room.room_id = product_img.room_id
	</select>
	
	<select id="roomListAjax" resultType="Room">
		SELECT * from room
	</select>
	
	<resultMap type="Room" id="RoomMap">
		<id column="room_id" property="roomId" />
		<result column="loc" property="loc"/>
		<result column="num" property="num"/>
		<result column="price" property="price"/>
		<result column="latitude" property="latitude"/>
		<result column="longitude" property="longitude"/>
		
		<collection property="images" column="room_id" ofType="ProductImage" javaType="ArrayList">
			<id column="productImg_id" property="productImgId"/>
			<result column="filename" property="filename"/>
			<result column="uuid" property="uuid"/>
		</collection>	
	</resultMap>
	
		<select id="total" resultType="Integer">
		SELECT COUNT(*)
		FROM room
		<include refid="search"></include>
	</select>	
	
	<select id="roomListPager" resultType="Room">
		SELECT *
		FROM room
		<include refid="search"></include>
		
		LIMIT #{offset}, #{perPage}
	</select>
	
	<delete id="deleteRoom">
		DELETE FROM room WHERE room_id= #{roomId}
	</delete>
	
	<update id="roomEdit">
		UPDATE room
		SET loc = #{loc}, max_number = #{maxNumber}, num = #{num}, price = #{price}
		WHERE room_id =#{roomId}
	</update>
	
	<insert id="workationOptionRegist">					
		INSERT INTO workation_option
		VALUES (NULL, #{workationName}, #{price}, #{detail})
	</insert>
	
	<select id="workationOptionList" resultType="WorkationOption">
		SELECT * FROM workation_option
	</select>
	
	<delete id="deleteWorkationOption">
		DELETE FROM workation_option WHERE workation_option_id= #{workationOptionId}
	</delete>
	
	<update id="workationOptionEdit">
		UPDATE workation_option
		SET workation_name = #{workationName}, price = #{price}, detail = #{detail}
		WHERE workation_option_id =#{workationOptionId}
	</update>
	
	<select id="selectRoom" resultType="Room">
		SELECT * FROM room
		WHERE room_id = #{roomId}
	</select>
	
	<select id="selectRoomOption" resultType="RoomOption">
		select * from room_option
		where room_option_id=#{roomOptionId}
	</select>
	
	<select id="selectWorkationOption" resultType="WorkationOption">
		select * from workation_option
		where workation_option_id=#{workationOptionId}
	</select>
	
	<select id="selectServiceOption" resultType="ServiceOption">
		select * from member
		where id=#{id}
	</select>
	
</mapper>












